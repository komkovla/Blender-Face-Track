from pathlib import Path
import bpy
import importlib
import sys
import numpy as np
from collections import namedtuple



# Global settings
MODULES_INSTALLED = False
TRACKER_COL_NAME = '.trackers'
FACE_COL_NAME = 'face_track'
FACE_PREPARED = False
DEBUG = False

# Dependancies variables
CV2 = None
MEDIAPIPE = None
Package = namedtuple('Package', ['name', 'installed', 'installing'])
package_names = [
    Package("opencv-contrib-python", False, False),
    Package("mediapipe", False, False)
]
FACE_PROPERTIE = 'face_track_mesh'
IS_PREPARED_PROPERTIE = 'is_prepared'



# Inits the addon
# - Check whether all modules could be imported
def init():
    global package_names
    print('init settings')
    for i, module in enumerate(package_names):
        if import_module(module.name, show_message = False) == None:
            print("can not import:", module.name)
            return False
        package_names[i] = Package(package_names[i].name, False, True)
        print("imported:", module.name)
    return True

# Show info panel with *message* and *icon*
def ShowMessageBox(message = "", title = "Message Box", icon = 'INFO'):
    def draw(self, context):
        self.layout.label(text=message)
    bpy.context.window_manager.popup_menu(draw, title = title, icon = icon)

# Try to import module
def import_module(name, show_message = True):
    if name == 'opencv-contrib-python' or name == 'cv2':
        global CV2
        if CV2 == None:
            try:
                CV2 = importlib.import_module('cv2')
            except:
                if show_message:
                    ShowMessageBox("Error importing CV2, please try to reinstall addon")
        return CV2
    if name == 'mediapipe':
        global MEDIAPIPE
        if MEDIAPIPE == None:
            try:
                MEDIAPIPE = importlib.import_module(name)
            except:
                if show_message:
                    ShowMessageBox("Error importing MEDIAPIPE, please try to reinstall addon")
        return MEDIAPIPE
    return True

# Convert coordinate from image spae to blender world space
def convert_units(vector, shape):
    # vector solution
    # vector[0] *= shape[1]
    # vector[1] *= shape[0]
    # vector[2] *= shape[1]
    # return [vector[0] / 100, vector[1] / 100, vector[2] / 100]

    # matrix solution
    matrix = [[shape[1]/100,0,0],[0,shape[0]/100,0],[0,0,shape[1]/100]]
    return np.dot(vector, matrix)

# Check whether operator is available for the object *obj*
def check_operator(cls, obj, is_face = 0, face_prepared = 0) -> bool:
    if obj == None:
        cls.poll_message_set("Choose face mesh")
        return False
    if not MODULES_INSTALLED:
        cls.poll_message_set("Dependancies are not installed")
        return False
    if FACE_PROPERTIE in obj:
        if not obj[FACE_PROPERTIE] == is_face:
            cls.poll_message_set("Only meshes created with addon are supported")
            return False
    else:
        cls.poll_message_set("Only meshes created with addon are supported")
        return False
    if IS_PREPARED_PROPERTIE in obj:
        if not obj[IS_PREPARED_PROPERTIE] == face_prepared:
            cls.poll_message_set("Mesh is already prepared")
            return False
    else:
        cls.poll_message_set("Only meshes created with addon are supported")
        return False
    return True


# Vertecies indecies for mesh creation a for a generic face
# Can not find source anymore((
MESH_FACES_WITH_MOUTH =  {(173, 155, 133), (246, 33, 7), (382, 398, 362), (263, 466, 249), (308, 415, 324), (78, 95, 191),
                (356, 389, 264), (127, 34, 162), (368, 264, 389), (139, 162, 34), (267, 0, 302), (37, 72, 0),
                (11, 302, 0),
                (11, 0, 72), (349, 451, 350), (120, 121, 231), (452, 350, 451), (232, 231, 121), (267, 302, 269),
                (37, 39, 72), (303, 269, 302), (73, 72, 39), (357, 343, 350), (128, 121, 114), (277, 350, 343),
                (47, 114, 121), (350, 452, 357), (121, 128, 232), (453, 357, 452), (233, 232, 128), (299, 333, 297),
                (69, 67, 104), (332, 297, 333), (103, 104, 67), (175, 152, 396), (175, 171, 152), (377, 396, 152),
                (148, 152, 171), (381, 384, 382), (154, 155, 157), (398, 382, 384), (173, 157, 155), (280, 347, 330),
                (50, 101, 118), (348, 330, 347), (119, 118, 101), (269, 303, 270), (39, 40, 73), (304, 270, 303),
                (74, 73, 40), (9, 336, 151), (9, 151, 107), (337, 151, 336), (108, 107, 151), (344, 278, 360),
                (115, 131, 48), (279, 360, 278), (49, 48, 131), (262, 431, 418), (32, 194, 211), (424, 418, 431),
                (204, 211, 194), (304, 408, 270), (74, 40, 184), (409, 270, 408), (185, 184, 40), (272, 310, 407),
                (42, 183, 80), (415, 407, 310), (191, 80, 183), (322, 270, 410), (92, 186, 40), (409, 410, 270),
                (185, 40, 186), (347, 449, 348), (118, 119, 229), (450, 348, 449), (230, 229, 119), (434, 432, 430),
                (214, 210, 212), (422, 430, 432), (202, 212, 210), (313, 314, 18), (83, 18, 84), (17, 18, 314),
                (17, 84, 18), (307, 375, 306), (77, 76, 146), (291, 306, 375), (61, 146, 76), (259, 387, 260),
                (29, 30, 160), (388, 260, 387), (161, 160, 30), (286, 414, 384), (56, 157, 190), (398, 384, 414),
                (173, 190, 157), (418, 424, 406), (194, 182, 204), (335, 406, 424), (106, 204, 182), (367, 416, 364),
                (138, 135, 192), (434, 364, 416), (214, 192, 135), (391, 423, 327), (165, 98, 203), (358, 327, 423),
                (129, 203, 98), (298, 301, 284), (68, 54, 71), (251, 284, 301), (21, 71, 54), (4, 275, 5), (4, 5, 45),
                (281, 5, 275), (51, 45, 5), (254, 373, 253), (24, 23, 144), (374, 253, 373), (145, 144, 23),
                (320, 321, 307), (90, 77, 91), (375, 307, 321), (146, 91, 77), (280, 425, 411), (50, 187, 205),
                (427, 411, 425), (207, 205, 187), (421, 313, 200), (201, 200, 83), (18, 200, 313), (18, 83, 200),
                (335, 321, 406), (106, 182, 91), (405, 406, 321), (181, 91, 182), (405, 321, 404), (181, 180, 91),
                (320, 404, 321), (90, 91, 180), (17, 314, 16), (17, 16, 84), (315, 16, 314), (85, 84, 16),
                (425, 266, 426),
                (205, 206, 36), (423, 426, 266), (203, 36, 206), (369, 396, 400), (140, 176, 171), (377, 400, 396),
                (148, 171, 176), (391, 269, 322), (165, 92, 39), (270, 322, 269), (40, 39, 92), (417, 465, 413),
                (193, 189, 245), (464, 413, 465), (244, 245, 189), (257, 258, 386), (27, 159, 28), (385, 386, 258),
                (158, 28, 159), (260, 388, 467), (30, 247, 161), (466, 467, 388), (246, 161, 247), (248, 456, 419),
                (3, 196, 236), (399, 419, 456), (174, 236, 196), (333, 298, 332), (104, 103, 68), (284, 332, 298),
                (54, 68, 103), (285, 8, 417), (55, 193, 8), (168, 417, 8), (168, 8, 193), (340, 261, 346),
                (111, 117, 31),
                (448, 346, 261), (228, 31, 117), (285, 417, 441), (55, 221, 193), (413, 441, 417), (189, 193, 221),
                (327, 460, 326), (98, 97, 240), (328, 326, 460), (99, 240, 97), (277, 355, 329), (47, 100, 126),
                (371, 329, 355), (142, 126, 100), (309, 392, 438), (79, 218, 166), (439, 438, 392), (219, 166, 218),
                (381, 382, 256), (154, 26, 155), (341, 256, 382), (112, 155, 26), (360, 279, 420), (131, 198, 49),
                (429, 420, 279), (209, 49, 198), (365, 364, 379), (136, 150, 135), (394, 379, 364), (169, 135, 150),
                (355, 277, 437), (126, 217, 47), (343, 437, 277), (114, 47, 217), (443, 444, 282), (223, 52, 224),
                (283, 282, 444), (53, 224, 52), (281, 275, 363), (51, 134, 45), (440, 363, 275), (220, 45, 134),
                (431, 262, 395), (211, 170, 32), (369, 395, 262), (140, 32, 170), (337, 299, 338), (108, 109, 69),
                (297, 338, 299), (67, 69, 109), (335, 273, 321), (106, 91, 43), (375, 321, 273), (146, 43, 91),
                (348, 450, 349), (119, 120, 230), (451, 349, 450), (231, 230, 120), (467, 359, 342), (247, 113, 130),
                (446, 342, 359), (226, 130, 113), (282, 283, 334), (52, 105, 53), (293, 334, 283), (63, 53, 105),
                (250, 458, 462), (20, 242, 238), (461, 462, 458), (241, 238, 242), (276, 353, 300), (46, 70, 124),
                (383, 300, 353), (156, 124, 70), (325, 292, 324), (96, 95, 62), (308, 324, 292), (78, 62, 95),
                (283, 276, 293), (53, 63, 46), (300, 293, 276), (70, 46, 63), (447, 264, 345), (227, 116, 34),
                (372, 345, 264), (143, 34, 116), (352, 345, 346), (123, 117, 116), (340, 346, 345), (111, 116, 117),
                (1, 19, 274), (1, 44, 19), (354, 274, 19), (125, 19, 44), (248, 281, 456), (3, 236, 51),
                (363, 456, 281),
                (134, 51, 236), (425, 426, 427), (205, 207, 206), (436, 427, 426), (216, 206, 207), (380, 381, 252),
                (153, 22, 154), (256, 252, 381), (26, 154, 22), (391, 393, 269), (165, 39, 167), (267, 269, 393),
                (37, 167, 39), (199, 428, 200), (199, 200, 208), (421, 200, 428), (201, 208, 200), (330, 329, 266),
                (101, 36, 100), (371, 266, 329), (142, 100, 36), (422, 432, 273), (202, 43, 212), (287, 273, 432),
                (57, 212, 43), (290, 250, 328), (60, 99, 20), (462, 328, 250), (242, 20, 99), (258, 286, 385),
                (28, 158, 56), (384, 385, 286), (157, 56, 158), (342, 446, 353), (113, 124, 226), (265, 353, 446),
                (35, 226, 124), (257, 386, 259), (27, 29, 159), (387, 259, 386), (160, 159, 29), (430, 422, 431),
                (210, 211, 202), (424, 431, 422), (204, 202, 211), (445, 342, 276), (225, 46, 113), (353, 276, 342),
                (124, 113, 46), (424, 422, 335), (204, 106, 202), (273, 335, 422), (43, 202, 106), (306, 292, 307),
                (76, 77, 62), (325, 307, 292), (96, 62, 77), (366, 447, 352), (137, 123, 227), (345, 352, 447),
                (116, 227, 123), (302, 268, 303), (72, 73, 38), (271, 303, 268), (41, 38, 73), (371, 358, 266),
                (142, 36, 129), (423, 266, 358), (203, 129, 36), (327, 294, 460), (98, 240, 64), (455, 460, 294),
                (235, 64, 240), (294, 331, 278), (64, 48, 102), (279, 278, 331), (49, 102, 48), (303, 271, 304),
                (73, 74, 41), (272, 304, 271), (42, 41, 74), (427, 436, 434), (207, 214, 216), (432, 434, 436),
                (212, 216, 214), (304, 272, 408), (74, 184, 42), (407, 408, 272), (183, 42, 184), (394, 430, 395),
                (169, 170, 210), (431, 395, 430), (211, 210, 170), (395, 369, 378), (170, 149, 140), (400, 378, 369),
                (176, 140, 149), (296, 334, 299), (66, 69, 105), (333, 299, 334), (104, 105, 69), (417, 168, 351),
                (193, 122, 168), (6, 351, 168), (6, 168, 122), (280, 411, 352), (50, 123, 187), (376, 352, 411),
                (147, 187, 123), (319, 320, 325), (89, 96, 90), (307, 325, 320), (77, 90, 96), (285, 295, 336),
                (55, 107, 65), (296, 336, 295), (66, 65, 107), (404, 320, 403), (180, 179, 90), (319, 403, 320),
                (89, 90, 179), (330, 348, 329), (101, 100, 119), (349, 329, 348), (120, 119, 100), (334, 293, 333),
                (105, 104, 63), (298, 333, 293), (68, 63, 104), (323, 454, 366), (93, 137, 234), (447, 366, 454),
                (227, 234, 137), (16, 315, 15), (16, 15, 85), (316, 15, 315), (86, 85, 15), (429, 279, 358),
                (209, 129, 49),
                (331, 358, 279), (102, 49, 129), (15, 316, 14), (15, 14, 86), (317, 14, 316), (87, 86, 14), (8, 285, 9),
                (8, 9, 55), (336, 9, 285), (107, 55, 9), (329, 349, 277), (100, 47, 120), (350, 277, 349),
                (121, 120, 47),
                (252, 253, 380), (22, 153, 23), (374, 380, 253), (145, 23, 153), (402, 403, 318), (178, 88, 179),
                (319, 318, 403), (89, 179, 88), (351, 6, 419), (122, 196, 6), (197, 419, 6), (197, 6, 196),
                (324, 318, 325),
                (95, 96, 88), (319, 325, 318), (89, 88, 96), (397, 367, 365), (172, 136, 138), (364, 365, 367),
                (135, 138, 136), (288, 435, 397), (58, 172, 215), (367, 397, 435), (138, 215, 172), (438, 439, 344),
                (218, 115, 219), (278, 344, 439), (48, 219, 115), (271, 311, 272), (41, 42, 81), (310, 272, 311),
                (80, 81, 42), (5, 281, 195), (5, 195, 51), (248, 195, 281), (3, 51, 195), (273, 287, 375),
                (43, 146, 57),
                (291, 375, 287), (61, 57, 146), (396, 428, 175), (171, 175, 208), (199, 175, 428), (199, 208, 175),
                (268, 312, 271), (38, 41, 82), (311, 271, 312), (81, 82, 41), (444, 445, 283), (224, 53, 225),
                (276, 283, 445), (46, 225, 53), (254, 339, 373), (24, 144, 110), (390, 373, 339), (163, 110, 144),
                (295, 282, 296), (65, 66, 52), (334, 296, 282), (105, 52, 66), (346, 448, 347), (117, 118, 228),
                (449, 347, 448), (229, 228, 118), (454, 356, 447), (234, 227, 127), (264, 447, 356), (34, 127, 227),
                (336, 296, 337), (107, 108, 66), (299, 337, 296), (69, 66, 108), (151, 337, 10), (151, 10, 108),
                (338, 10, 337), (109, 108, 10), (278, 439, 294), (48, 64, 219), (455, 294, 439), (235, 219, 64),
                (407, 415, 292), (183, 62, 191), (308, 292, 415), (78, 191, 62), (358, 371, 429), (129, 209, 142),
                (355, 429, 371), (126, 142, 209), (345, 372, 340), (116, 111, 143), (265, 340, 372), (35, 143, 111),
                (388, 390, 466), (161, 246, 163), (249, 466, 390), (7, 163, 246), (352, 346, 280), (123, 50, 117),
                (347, 280, 346), (118, 117, 50), (295, 442, 282), (65, 52, 222), (443, 282, 442), (223, 222, 52),
                (19, 94, 354), (19, 125, 94), (370, 354, 94), (141, 94, 125), (295, 285, 442), (65, 222, 55),
                (441, 442, 285), (221, 55, 222), (419, 197, 248), (196, 3, 197), (195, 248, 197), (195, 197, 3),
                (359, 263, 255), (130, 25, 33), (249, 255, 263), (7, 33, 25), (275, 274, 440), (45, 220, 44),
                (457, 440, 274), (237, 44, 220), (300, 383, 301), (70, 71, 156), (368, 301, 383), (139, 156, 71),
                (417, 351, 465), (193, 245, 122), (412, 465, 351), (188, 122, 245), (466, 263, 467), (246, 247, 33),
                (359, 467, 263), (130, 33, 247), (389, 251, 368), (162, 139, 21), (301, 368, 251), (71, 21, 139),
                (374, 386, 380), (145, 153, 159), (385, 380, 386), (158, 159, 153), (379, 394, 378), (150, 149, 169),
                (395, 378, 394), (170, 169, 149), (351, 419, 412), (122, 188, 196), (399, 412, 419), (174, 196, 188),
                (426, 322, 436), (206, 216, 92), (410, 436, 322), (186, 92, 216), (387, 373, 388), (160, 161, 144),
                (390, 388, 373), (163, 144, 161), (393, 326, 164), (167, 164, 97), (2, 164, 326), (2, 97, 164),
                (354, 370, 461), (125, 241, 141), (462, 461, 370), (242, 141, 241), (0, 267, 164), (0, 164, 37),
                (393, 164, 267), (167, 37, 164), (11, 12, 302), (11, 72, 12), (268, 302, 12), (38, 12, 72),
                (386, 374, 387),
                (159, 160, 145), (373, 387, 374), (144, 145, 160), (12, 13, 268), (12, 38, 13), (312, 268, 13),
                (82, 13, 38), (293, 300, 298), (63, 68, 70), (301, 298, 300), (71, 70, 68), (340, 265, 261),
                (111, 31, 35),
                (446, 261, 265), (226, 35, 31), (380, 385, 381), (153, 154, 158), (384, 381, 385), (157, 158, 154),
                (280, 330, 425), (50, 205, 101), (266, 425, 330), (36, 101, 205), (423, 391, 426), (203, 206, 165),
                (322, 426, 391), (92, 165, 206), (429, 355, 420), (209, 198, 126), (437, 420, 355), (217, 126, 198),
                (391, 327, 393), (165, 167, 98), (326, 393, 327), (97, 98, 167), (457, 438, 440), (237, 220, 218),
                (344, 440, 438), (115, 218, 220), (382, 362, 341), (155, 112, 133), (463, 341, 362), (243, 133, 112),
                (457, 461, 459), (237, 239, 241), (458, 459, 461), (238, 241, 239), (434, 430, 364), (214, 135, 210),
                (394, 364, 430), (169, 210, 135), (414, 463, 398), (190, 173, 243), (362, 398, 463), (133, 243, 173),
                (262, 428, 369), (32, 140, 208), (396, 369, 428), (171, 208, 140), (457, 274, 461), (237, 241, 44),
                (354, 461, 274), (125, 44, 241), (316, 403, 317), (86, 87, 179), (402, 317, 403), (178, 179, 87),
                (315, 404, 316), (85, 86, 180), (403, 316, 404), (179, 180, 86), (314, 405, 315), (84, 85, 181),
                (404, 315, 405), (180, 181, 85), (313, 406, 314), (83, 84, 182), (405, 314, 406), (181, 182, 84),
                (418, 406, 421), (194, 201, 182), (313, 421, 406), (83, 182, 201), (366, 401, 323), (137, 93, 177),
                (361, 323, 401), (132, 177, 93), (408, 407, 306), (184, 76, 183), (292, 306, 407), (62, 183, 76),
                (408, 306, 409), (184, 185, 76), (291, 409, 306), (61, 76, 185), (410, 409, 287), (186, 57, 185),
                (291, 287, 409), (61, 185, 57), (436, 410, 432), (216, 212, 186), (287, 432, 410), (57, 186, 212),
                (434, 416, 427), (214, 207, 192), (411, 427, 416), (187, 192, 207), (264, 368, 372), (34, 143, 139),
                (383, 372, 368), (156, 139, 143), (457, 459, 438), (237, 218, 239), (309, 438, 459), (79, 239, 218),
                (352, 376, 366), (123, 137, 147), (401, 366, 376), (177, 147, 137), (4, 1, 275), (4, 45, 1),
                (274, 275, 1),
                (44, 1, 45), (428, 262, 421), (208, 201, 32), (418, 421, 262), (194, 32, 201), (327, 358, 294),
                (98, 64, 129), (331, 294, 358), (102, 129, 64), (367, 435, 416), (138, 192, 215), (433, 416, 435),
                (213, 215, 192), (455, 439, 289), (235, 59, 219), (392, 289, 439), (166, 219, 59), (328, 462, 326),
                (99, 97, 242), (370, 326, 462), (141, 242, 97), (326, 370, 2), (97, 2, 141), (94, 2, 370), (94, 141, 2),
                (460, 455, 305), (240, 75, 235), (289, 305, 455), (59, 235, 75), (448, 339, 449), (228, 229, 110),
                (254, 449, 339), (24, 110, 229), (261, 446, 255), (31, 25, 226), (359, 255, 446), (130, 226, 25),
                (449, 254, 450), (229, 230, 24), (253, 450, 254), (23, 24, 230), (450, 253, 451), (230, 231, 23),
                (252, 451, 253), (22, 23, 231), (451, 252, 452), (231, 232, 22), (256, 452, 252), (26, 22, 232),
                (256, 341, 452), (26, 232, 112), (453, 452, 341), (233, 112, 232), (413, 464, 414), (189, 190, 244),
                (463, 414, 464), (243, 244, 190), (441, 413, 286), (221, 56, 189), (414, 286, 413), (190, 189, 56),
                (441, 286, 442), (221, 222, 56), (258, 442, 286), (28, 56, 222), (442, 258, 443), (222, 223, 28),
                (257, 443, 258), (27, 28, 223), (444, 443, 259), (224, 29, 223), (257, 259, 443), (27, 223, 29),
                (259, 260, 444), (29, 224, 30), (445, 444, 260), (225, 30, 224), (260, 467, 445), (30, 225, 247),
                (342, 445, 467), (113, 247, 225), (250, 309, 458), (20, 238, 79), (459, 458, 309), (239, 79, 238),
                (290, 305, 392), (60, 166, 75), (289, 392, 305), (59, 75, 166), (460, 305, 328), (240, 99, 75),
                (290, 328, 305), (60, 75, 99), (376, 433, 401), (147, 177, 213), (435, 401, 433), (215, 213, 177),
                (250, 290, 309), (20, 79, 60), (392, 309, 290), (166, 60, 79), (411, 416, 376), (187, 147, 192),
                (433, 376, 416), (213, 192, 147), (341, 463, 453), (112, 233, 243), (464, 453, 463), (244, 243, 233),
                (453, 464, 357), (233, 128, 244), (465, 357, 464), (245, 244, 128), (412, 343, 465), (188, 245, 114),
                (357, 465, 343), (128, 114, 245), (437, 343, 399), (217, 174, 114), (412, 399, 343), (188, 114, 174),
                (363, 440, 360), (134, 131, 220), (344, 360, 440), (115, 220, 131), (456, 420, 399), (236, 174, 198),
                (437, 399, 420), (217, 198, 174), (456, 363, 420), (236, 198, 134), (360, 420, 363), (131, 134, 198),
                (361, 401, 288), (132, 58, 177), (435, 288, 401), (215, 177, 58), (353, 265, 383), (124, 156, 35),
                (372, 383, 265), (143, 35, 156), (255, 249, 339), (25, 110, 7), (390, 339, 249), (163, 7, 110),
                (261, 255, 448), (31, 228, 25), (339, 448, 255), (110, 25, 228), (14, 317, 13), (14, 13, 87),
                (312, 13, 317), (82, 87, 13), (317, 402, 312), (87, 82, 178), (311, 312, 402), (81, 178, 82),
                (402, 318, 311), (178, 81, 88), (310, 311, 318), (80, 88, 81), (318, 324, 310), (88, 80, 95),
                (415, 310, 324), (191, 95, 80)}

# Vertecies triangles for mesh with cut for the mouth
MESH_FACES = {
    (316, 403, 317), (9, 151, 107), (124, 113, 46), (328, 326, 460), (124, 156, 35), (138, 215, 172), (58, 172, 215), (231, 230, 120), (163, 7, 110), (264, 368, 372), (161, 160, 30), (50, 123, 187), (154, 155, 157), (98, 64, 129), (150, 149, 169), (398, 382, 384), (118, 119, 229), (291, 306, 375), (148, 171, 176), (391, 269, 322), (142, 36, 129), (8, 285, 9), (338, 10, 337), (146, 91, 77), (159, 160, 145), (115, 218, 220), (274, 275, 1), (381, 384, 382), (221, 222, 56), (123, 137, 147), (30, 225, 247), (298, 333, 293), (276, 283, 445), (442, 258, 443), (347, 280, 346), (443, 444, 282), (422, 432, 273), (354, 370, 461), (175, 152, 396), (324, 318, 325), (125, 44, 241), (455, 439, 289), (415, 407, 310), (333, 298, 332), (8, 9, 55), (115, 220, 131), (121, 120, 47), (286, 414, 384), (12, 13, 268), (306, 292, 307), (254, 449, 339), (349, 451, 350), (421, 313, 200), (383, 300, 353), (316, 15, 315), (108, 109, 69), (252, 253, 380), (367, 435, 416), (245, 244, 128), (380, 381, 252), (242, 141, 241), (191, 80, 183), (105, 104, 63), (181, 91, 182), (190, 189, 56), (215, 177, 58), (17, 314, 16), (395, 378, 394), (257, 258, 386), (256, 341, 452), (208, 201, 32), (267, 269, 393), (373, 387, 374), (360, 420, 363), (74, 40, 184), (325, 307, 292), (171, 208, 140), (218, 115, 219), (334, 293, 333), (453, 464, 357), (183, 42, 184), (60, 99, 20), (290, 328, 305), (107, 108, 66), (137, 93, 177), (115, 131, 48), (312, 268, 13), (242, 20, 99), (154, 26, 155), (366, 447, 352), (342, 445, 467), (372, 383, 265), (280, 330, 425), (391, 327, 393), (408, 306, 409), (148, 152, 171), (287, 432, 410), (435, 288, 401), (220, 45, 134), (233, 112, 232), (230, 229, 119), (70, 71, 156), (426, 322, 436), (453, 452, 341), (465, 357, 464), (48, 64, 219), (180, 181, 85), (106, 204, 182), (427, 436, 434), (234, 227, 127), (80, 81, 42), (65, 52, 222), (237, 239, 241), (7, 33, 25), (102, 49, 129), (237, 220, 218), (131, 198, 49), (350, 452, 357), (185, 184, 40), (449, 347, 448), (120, 119, 100), (12, 38, 13), (44, 1, 45), (409, 270, 408), (460, 305, 328), (383, 372, 368), (459, 458, 309), (456, 420, 399), (232, 231, 121), (339, 448, 255), (462, 328, 250), (59, 75, 166), (11, 0, 72), (343, 437, 277), (270, 322, 269), (237, 241, 44), (141, 94, 125), (340, 261, 346), (11, 12, 302), (462, 461, 370), (165, 167, 98), (194, 182, 204), (0, 267, 164), (294, 331, 278), (423, 391, 426), (41, 42, 81), (441, 413, 286), (129, 209, 142), (92, 165, 206), (90, 77, 91), (400, 378, 369), (157, 158, 154), (457, 459, 438), (143, 34, 116), (385, 380, 386), (55, 221, 193), (296, 334, 299), (313, 421, 406), (289, 305, 455), (424, 422, 335), (20, 238, 79), (423, 426, 266), (418, 406, 421), (348, 330, 347), (37, 72, 0), (308, 292, 415), (94, 2, 370), (166, 60, 79), (219, 166, 218), (405, 314, 406), (412, 465, 351), (74, 184, 42), (86, 85, 15), (319, 325, 318), (355, 429, 371), (64, 48, 102), (353, 265, 383), (277, 355, 329), (188, 114, 174), (195, 197, 3), (401, 366, 376), (422, 430, 432), (335, 273, 321), (181, 180, 91), (7, 163, 246), (140, 176, 171), (188, 245, 114), (405, 321, 404), (34, 127, 227), (4, 45, 1), (398, 384, 414), (222, 223, 28), (266, 425, 330), (100, 47, 120), (309, 392, 438), (295, 442, 282), (228, 31, 117), (19, 125, 94), (441, 442, 285), (291, 375, 287), (204, 106, 202), (434, 430, 364), (390, 339, 249), (429, 279, 358), (199, 175, 428), (430, 422, 431), (409, 410, 270), (173, 155, 133), (20, 242, 238), (293, 334, 283), (98, 97, 240), (171, 175, 208), (257, 259, 443), (260, 467, 445), (113, 124, 226), (387, 259, 386), (139, 162, 34), (24, 144, 110), (441, 286, 442), (163, 144, 161), (368, 301, 383), (162, 139, 21), (395, 369, 378), (310, 272, 311), (47, 100, 126), (99, 97, 242), (25, 110, 7), (141, 242, 97), (440, 363, 275), (4, 5, 45), (293, 300, 298), (121, 128, 232), (319, 318, 403), (53, 224, 52), (408, 407, 306), (357, 343, 350), (292, 306, 407), (247, 113, 130), (446, 342, 359), (214, 207, 192), (24, 110, 229), (463, 341, 362), (326, 393, 327), (289, 392, 305), (94, 141, 2), (257, 386, 259), (280, 411, 352), (111, 117, 31), (133, 243, 173), (453, 357, 452), (444, 443, 259), (367, 416, 364), (71, 21, 139), (443, 282, 442), (153, 154, 158), (457, 438, 440), (173, 157, 155), (26, 232, 112), (239, 79, 238), (213, 215, 192), (329, 349, 277), (123, 117, 116), (89, 179, 88), (313, 314, 18), (436, 410, 432), (42, 183, 80), (352, 376, 366), (89, 96, 90), (49, 102, 48), (38, 41, 82), (300, 383, 301), (244, 245, 189), (165, 92, 39), (17, 84, 18), (457, 461, 459), (102, 129, 64), (41, 38, 73), (257, 443, 258), (298, 301, 284), (361, 401, 288), (277, 350, 343), (304, 408, 270), (142, 126, 100), (261, 255, 448), (327, 294, 460), (5, 195, 51), (438, 439, 344), (180, 179, 90), (402, 403, 318), (119, 120, 230), (140, 32, 170), (290, 250, 328), (336, 9, 285), (240, 75, 235), (217, 198, 174), (127, 34, 162), (405, 406, 321), (163, 110, 144), (132, 177, 93), (156, 139, 143), (428, 262, 421), (43, 146, 57), (299, 337, 296), (233, 232, 128), (230, 231, 23), (146, 43, 91), (352, 345, 346), (237, 44, 220), (62, 183, 76), (65, 222, 55), (279, 360, 278), (345, 352, 447), (450, 253, 451), (69, 67, 104), (165, 98, 203), (467, 359, 342), (399, 419, 456), (288, 435, 397), (105, 52, 66), (431, 262, 395), (85, 84, 16), (431, 395, 430), (285, 295, 336), (204, 211, 194), (336, 296, 337), (248, 281, 456), (334, 296, 282), (203, 206, 165), (43, 202, 106), (356, 389, 264), (227, 116, 34), (130, 25, 33), (322, 426, 391), (332, 297, 333), (287, 273, 432), (282, 283, 334), (308, 324, 292), (390, 373, 339), (187, 147, 192), (97, 98, 167), (417, 351, 465), (226, 35, 31), (371, 266, 329), (273, 335, 422), (57, 186, 212), (79, 239, 218), (319, 403, 320), (330, 329, 266), (221, 56, 189), (1, 19, 274), (90, 91, 180), (258, 442, 286), (457, 274, 461), (235, 59, 219), (315, 404, 316), (179, 180, 86), (374, 253, 373), (227, 234, 137), (249, 255, 263), (169, 210, 135), (17, 16, 84), (402, 317, 403), (109, 108, 10), (178, 179, 87), (388, 390, 466), (434, 416, 427), (170, 149, 140), (60, 75, 99), (86, 87, 179), (233, 128, 244), (138, 192, 215), (392, 289, 439), (337, 299, 338), (251, 284, 301), (84, 85, 181), (425, 266, 426), (178, 88, 179), (466, 263, 467), (223, 52, 224), (36, 101, 205), (253, 450, 254), (9, 336, 151), (56, 157, 190), (262, 431, 418), (254, 339, 373), (4, 1, 275), (355, 277, 437), (6, 168, 122), (458, 459, 461), (236, 174, 198), (454, 356, 447), (283, 282, 444), (450, 348, 449), (213, 192, 147), (77, 90, 96), (130, 33, 247), (158, 28, 159), (369, 396, 400), (340, 346, 345), (351, 6, 419), (413, 441, 417), (303, 269, 302), (363, 440, 360), (243, 244, 190), (243, 133, 112), (323, 454, 366), (248, 456, 419), (137, 123, 227), (11, 72, 12), (327, 358, 294), (235, 219, 64), (346, 448, 347), (341, 463, 453), (320, 321, 307), (59, 235, 75), (52, 105, 53), (407, 408, 272), (1, 44, 19), (202, 43, 212), (301, 298, 300), (254, 373, 253), (51, 45, 5), (30, 247, 161), (187, 192, 207), (413, 464, 414), (374, 386, 380), (205, 206, 36), (125, 19, 44), (375, 307, 321), (203, 36, 206), (101, 36, 100), (377, 396, 152), (48, 219, 115), (47, 114, 121), (26, 22, 232), (399, 412, 419), (35, 226, 124), (57, 212, 43), (116, 227, 123), (106, 182, 91), (363, 456, 281), (393, 326, 164), (106, 91, 43), (82, 13, 38), (181, 182, 84), (156, 124, 70), (112, 233, 243), (21, 71, 54), (138, 135, 192), (226, 130, 113), (175, 171, 152), (250, 458, 462), (284, 332, 298), (302, 268, 303), (134, 131, 220), (372, 345, 264), (433, 416, 435), (411, 416, 376), (389, 251, 368), (145, 23, 153), (315, 16, 314), (204, 202, 211), (410, 436, 322), (368, 264, 389), (42, 41, 74), (131, 134, 198), (325, 292, 324), (417, 465, 413), (394, 379, 364), (455, 294, 439), (361, 323, 401), (28, 56, 222), (314, 405, 315), (113, 247, 225), (119, 118, 101), (16, 315, 15), (344, 440, 438), (224, 29, 223), (364, 365, 367), (92, 186, 40), (421, 200, 428), (205, 207, 206), (272, 304, 271), (193, 122, 168), (396, 369, 428), (29, 224, 30), (301, 368, 251), (365, 364, 379), (432, 434, 436), (129, 203, 98), (260, 388, 467), (264, 447, 356), (217, 174, 114), (381, 382, 256), (351, 419, 412), (174, 196, 188), (246, 161, 247), (377, 400, 396), (193, 245, 122), (263, 466, 249), (111, 116, 117), (313, 406, 314), (371, 358, 266), (144, 145, 160), (63, 53, 105), (309, 438, 459), (24, 23, 144), (18, 200, 313), (37, 167, 39), (51, 134, 45), (271, 303, 268), (249, 466, 390), (83, 18, 84), (29, 30, 160), (3, 51, 195), (83, 182, 201), (261, 446, 255), (168, 417, 8), (326, 370, 2), (39, 40, 73), (73, 72, 39), (3, 236, 51), (112, 155, 26), (160, 161, 144), (54, 68, 103), (256, 252, 381), (391, 423, 327), (295, 285, 442), (369, 395, 262), (11, 302, 0), (123, 50, 117), (61, 76, 185), (132, 58, 177), (23, 24, 230), (335, 321, 406), (384, 385, 286), (71, 70, 68), (414, 286, 413), (295, 282, 296), (22, 23, 231), (435, 401, 433), (108, 107, 151), (31, 25, 226), (196, 3, 197), (464, 413, 465), (250, 309, 458), (366, 401, 323), (320, 404, 321), (77, 76, 146), (228, 229, 110), (186, 57, 185), (394, 430, 395), (49, 48, 131), (457, 440, 274), (248, 195, 281), (165, 39, 167), (32, 140, 208), (83, 84, 182), (291, 409, 306), (55, 193, 8), (404, 315, 405), (104, 103, 68), (209, 198, 126), (419, 197, 248), (382, 398, 362), (456, 363, 420), (272, 310, 407), (345, 372, 340), (155, 112, 133), (358, 371, 429), (238, 241, 239), (307, 325, 320), (95, 96, 88), (225, 46, 113), (258, 286, 385), (6, 351, 168), (354, 461, 274), (27, 28, 223), (40, 39, 92), (157, 56, 158), (396, 428, 175), (68, 54, 71), (330, 348, 329), (461, 462, 458), (60, 166, 75), (16, 15, 85), (122, 196, 6), (349, 329, 348), (145, 144, 23), (63, 68, 70), (451, 349, 450), (15, 14, 86), (390, 388, 373), (259, 260, 444), (278, 344, 439), (116, 111, 143), (436, 427, 426), (97, 2, 141), (217, 126, 198), (376, 433, 401), (27, 159, 28), (174, 236, 196), (374, 380, 253), (437, 420, 355), (153, 22, 154), (235, 64, 240), (262, 428, 369), (256, 452, 252), (111, 31, 35), (344, 360, 440), (96, 62, 77), (397, 367, 365), (350, 277, 349), (2, 164, 326), (136, 150, 135), (328, 462, 326), (347, 449, 348), (439, 438, 392), (38, 12, 72), (259, 387, 260), (370, 326, 462), (357, 465, 343), (303, 271, 304), (170, 169, 149), (151, 337, 10), (28, 158, 56), (160, 159, 29), (394, 364, 430), (37, 39, 72), (252, 451, 253), (231, 232, 22), (455, 460, 294), (250, 290, 309), (359, 263, 255), (126, 142, 209), (197, 419, 6), (199, 200, 208), (344, 278, 360), (387, 373, 388), (246, 247, 33), (45, 220, 44), (223, 222, 52), (267, 302, 269), (215, 213, 177), (61, 146, 76), (449, 254, 450), (275, 274, 440), (2, 97, 164), (240, 99, 75), (211, 170, 32), (362, 398, 463), (169, 170, 210), (216, 212, 186), (17, 18, 314), (445, 342, 276), (197, 6, 196), (0, 164, 37), (304, 270, 303), (280, 425, 411), (193, 189, 245), (299, 333, 297), (142, 100, 36), (300, 293, 276), (280, 347, 330), (269, 303, 270), (268, 302, 12), (194, 201, 182), (317, 14, 316), (107, 55, 9), (446, 261, 265), (78, 62, 95), (202, 212, 210), (201, 208, 200), (424, 431, 422), (93, 137, 234), (167, 37, 164), (434, 432, 430), (307, 375, 306), (414, 463, 398), (214, 135, 210), (388, 260, 387), (392, 309, 290), (278, 439, 294), (55, 107, 65), (464, 453, 463), (452, 350, 451), (161, 246, 163), (447, 264, 345), (158, 159, 153), (437, 343, 399), (168, 8, 193), (376, 352, 411), (423, 266, 358), (268, 312, 271), (167, 164, 97), (434, 364, 416), (337, 151, 336), (199, 208, 175), (285, 417, 441), (291, 287, 409), (265, 353, 446), (281, 5, 275), (375, 321, 273), (151, 10, 108), (348, 450, 349), (445, 444, 260), (3, 196, 236), (87, 86, 14), (448, 346, 261), (229, 228, 118), (114, 47, 217), (61, 185, 57), (61, 57, 146), (267, 0, 302), (283, 276, 293), (27, 29, 159), (212, 216, 214), (384, 381, 385), (290, 305, 392), (354, 274, 19), (319, 320, 325), (15, 316, 14), (89, 90, 179), (335, 406, 424), (201, 200, 83), (311, 271, 312), (359, 467, 263), (65, 66, 52), (379, 394, 378), (451, 252, 452), (225, 30, 224), (276, 353, 300), (20, 79, 60), (437, 399, 420), (134, 51, 236), (331, 294, 358), (166, 219, 59), (120, 121, 231), (285, 8, 417), (207, 205, 187), (209, 49, 198), (189, 190, 244), (76, 77, 62), (199, 428, 200), (19, 94, 354), (81, 82, 41), (70, 46, 63), (135, 138, 136), (147, 177, 213), (79, 218, 166), (27, 223, 29), (53, 63, 46), (407, 415, 292), (194, 32, 201), (73, 74, 41), (4, 275, 5), (98, 240, 64), (125, 241, 141), (410, 409, 287), (412, 399, 343), (68, 63, 104), (265, 340, 372), (385, 386, 258), (128, 121, 114), (210, 211, 202), (22, 153, 23), (331, 358, 279), (229, 230, 24), (411, 427, 416), (271, 311, 272), (46, 225, 53), (186, 92, 216), (403, 316, 404), (172, 136, 138), (237, 218, 239), (412, 343, 465), (184, 76, 183), (130, 226, 25), (145, 153, 159), (89, 88, 96), (391, 393, 269), (18, 83, 200), (72, 73, 38), (281, 275, 363), (74, 73, 40), (46, 70, 124), (322, 270, 410), (50, 187, 205), (50, 205, 101), (273, 287, 375), (418, 421, 262), (188, 122, 245), (296, 336, 295), (195, 248, 197), (31, 228, 25), (246, 33, 7), (417, 168, 351), (447, 366, 454), (448, 339, 449), (214, 210, 212), (211, 210, 170), (340, 265, 261), (341, 256, 382), (433, 376, 416), (425, 426, 427), (66, 65, 107), (147, 187, 123), (429, 420, 279), (66, 69, 105), (32, 194, 211), (359, 255, 446), (216, 206, 207), (353, 276, 342), (35, 143, 111), (184, 185, 76), (463, 414, 464), (209, 129, 49), (386, 374, 387), (206, 216, 92), (67, 69, 109), (380, 385, 381), (221, 55, 222), (371, 329, 355), (444, 445, 283), (214, 192, 135), (5, 281, 195), (224, 53, 225), (118, 117, 50), (429, 355, 420), (103, 104, 67), (85, 86, 180), (173, 190, 157), (99, 240, 97), (177, 147, 137), (183, 62, 191), (96, 95, 62), (190, 173, 243), (370, 354, 94), (128, 114, 245), (427, 411, 425), (122, 188, 196), (143, 35, 156), (244, 243, 233), (424, 418, 431), (360, 279, 420), (279, 278, 331), (78, 191, 62), (342, 446, 353), (101, 100, 119), (358, 327, 423), (327, 460, 326), (189, 193, 221), (139, 156, 71), (460, 455, 305), (333, 299, 334), (117, 118, 228), (352, 346, 280), (304, 272, 408), (382, 362, 341), (404, 320, 403), (126, 217, 47), (393, 164, 267), (26, 154, 22), (169, 135, 150), (69, 66, 108), (418, 424, 406), (110, 25, 228), (104, 105, 69), (241, 238, 242), (176, 140, 149), (466, 467, 388), (255, 249, 339), (185, 40, 186), (207, 214, 216), (236, 198, 134), (297, 338, 299), (50, 101, 118), (367, 397, 435), (34, 143, 139), (203, 129, 36)}

